DatabaseManager
DatabaseManager — это современное десктопное приложение на C# с использованием WPF и PostgreSQL, предназначенное для управления финансовыми данными предприятия. Оно обеспечивает учет основных средств, транзакций, зарплат, налогов, инвентаризации и формирование бухгалтерских отчетов. Приложение разработано с учетом лучших практик объектно-ориентированного программирования, включая использование паттерна проектирования "Стратегия", архитектурного шаблона MVVM, принципов SOLID и соглашений Microsoft по написанию кода.
О проекте
DatabaseManager создан в рамках задания по разработке десктопного приложения для управления базой данных в предметной области финансового учета. Приложение поддерживает широкий набор функций, включая управление данными, расчеты, экспорт/импорт в формате JSON и генерацию отчетов. Оно ориентировано на пользователей, которым требуется надежное и гибкое решение для автоматизации финансовых процессов.
Основные возможности

Управление данными:
Учет пользователей, ролей, контрагентов, банковских счетов, контрактов, плана счетов, транзакций, документов, основных средств, инвентаря, сотрудников и финансовых отчетов.
Поддержка CRUD-операций (создание, чтение, обновление, удаление) для всех сущностей.


Расчет амортизации:
Реализация линейного метода и метода уменьшаемого остатка с использованием паттерна "Стратегия".


Расчет налогов:
Поддержка НДФЛ (13%) и социальных налогов (30%) через паттерн "Стратегия".


Экспорт и импорт данных:
Выгрузка данных в JSON-файлы и загрузка из них для резервного копирования или обмена данными.


Финансовые отчеты:
Генерация оборотно-сальдовой ведомости, бухгалтерского баланса, расчет дебиторской/кредиторской задолженности и НДС.


Инвентаризация:
Учет остатков на складах и контроль перемещений инвентаря.



Требования задания
Приложение разработано в строгом соответствии с требованиями задания. Ниже описано, как каждый пункт был реализован.
1. Паттерн проектирования (кроме Singleton)
В проекте используется паттерн "Стратегия" для инкапсуляции алгоритмов расчета амортизации и налогов. Это позволяет легко добавлять новые методы расчета без изменения существующего кода.

IDepreciationStrategy:

Интерфейс определяет методы CalculateDepreciation и GetMethodName.
Реализации:
StraightLineDepreciationStrategy — линейный метод амортизации.
DecliningBalanceDepreciationStrategy — метод уменьшаемого остатка.


Использование: Выбор стратегии осуществляется в MainViewModel в зависимости от пользовательского ввода (SelectedDepreciationMethod).


ITaxStrategy:

Интерфейс определяет методы CalculateTax и GetTaxType.
Реализации:
IncomeTaxStrategy — расчет НДФЛ (13%).
SocialTaxStrategy — расчет социальных налогов (30%).


Использование: Стратегия передается в метод CalculateAndSaveSalaryAsync в DatabaseService.



Паттерн "Стратегия" обеспечивает гибкость и расширяемость, позволяя добавлять новые алгоритмы без модификации основного кода.
2. Принципы SOLID
Проект следует принципам SOLID, что обеспечивает чистоту, поддерживаемость и масштабируемость кода.

S (Single Responsibility Principle):
Каждый класс выполняет одну задачу. Например:
DatabaseService отвечает за взаимодействие с базой данных.
JsonService управляет экспортом и импортом JSON.
MainViewModel обрабатывает логику пользовательского интерфейса.




O (Open/Closed Principle):
Классы открыты для расширения, но закрыты для модификации. Например, новые стратегии амортизации или налогов можно добавить, реализуя IDepreciationStrategy или ITaxStrategy, без изменения существующего кода.


L (Liskov Substitution Principle):
Реализации интерфейсов (StraightLineDepreciationStrategy, IncomeTaxStrategy и т.д.) взаимозаменяемы без нарушения логики программы.


I (Interface Segregation Principle):
Интерфейсы (IDepreciationStrategy, ITaxStrategy) содержат только необходимые методы, избегая "толстых" интерфейсов.


D (Dependency Inversion Principle):
Зависимости инвертированы через интерфейсы. Например, DatabaseService зависит от абстракций IDepreciationStrategy и ITaxStrategy, а не от их конкретных реализаций.



3. Соглашения Microsoft по написанию кода
Код написан в соответствии с рекомендациями Microsoft для C#:

Имена идентификаторов:
Используется PascalCase для имен классов, методов и свойств (например, MainViewModel, CalculateDepreciation).
Используется camelCase для локальных переменных и параметров (например, connectionString, assetId).
Константы и приватные поля используют префикс _ и camelCase (например, _connectionString).
Интерфейсы начинаются с префикса I (например, IDepreciationStrategy).


Соглашения о написании кода:
Используются XML-комментарии для документирования публичных членов.
Код форматирован с отступами (4 пробела) и переносами строк для читаемости.
Логические блоки разделены пустыми строками.
Используется async/await для асинхронных операций (например, CalculateAndSaveDepreciationAsync).
Константы и строки подключения вынесены в отдельные переменные или конфигурационные файлы.
Исключения обрабатываются с помощью блоков try-catch для повышения надежности.



4. Архитектурный шаблон MVVM
Приложение построено на основе шаблона MVVM (Model-View-ViewModel), который обеспечивает разделение логики представления и бизнес-логики.

Model:
Классы, представляющие сущности базы данных, такие как FixedAsset, Transaction, Employee.
Содержат свойства для хранения данных и минимальную логику валидации.


View:
XAML-файлы (например, MainWindow.xaml) определяют пользовательский интерфейс.
Используются привязки данных (Binding) для связи с ViewModel.


ViewModel:
Класс MainViewModel управляет логикой интерфейса, командами (ICommand) и взаимодействием с сервисами.
Реализует INotifyPropertyChanged для уведомления интерфейса об изменениях.
Примеры команд: CalculateDepreciationCommand, RegisterTransactionCommand.



MVVM обеспечивает тестируемость, масштабируемость и поддержку слабого связывания между слоями приложения.
5. Экспорт и импорт JSON
Функциональность экспорта и импорта данных реализована с использованием библиотеки Newtonsoft.Json.

Экспорт:
Данные из выбранной таблицы (например, FixedAssets, Transactions) сериализуются в JSON-файл.
Пользователь выбирает путь для сохранения файла через диалоговое окно (Microsoft.Win32.SaveFileDialog).
Метод ExportToJsonAsync в JsonService отвечает за сериализацию.


Импорт:
JSON-файл десериализуется в объекты модели, которые затем сохраняются в базе данных.
Пользователь выбирает файл через Microsoft.Win32.OpenFileDialog.
Метод ImportFromJsonAsync в JsonService отвечает за десериализацию и сохранение.



Эта функциональность позволяет пользователям создавать резервные копии данных или обмениваться ими между разными экземплярами приложения.
Технологии

Язык программирования: C#
Фреймворк: .NET (WPF для интерфейса)
База данных: PostgreSQL (с использованием Npgsql для подключения)
Библиотеки:
Newtonsoft.Json — для работы с JSON.
Microsoft.Win32 — для диалоговых окон выбора файлов.
Npgsql — для взаимодействия с PostgreSQL.


Архитектурные шаблоны:
MVVM (Model-View-ViewModel)
Паттерн "Стратегия" (для амортизации и налогов)


IDE: Visual Studio 2022
Система контроля версий: Git (репозиторий на GitHub)

Установка
Следуйте этим шагам, чтобы установить и запустить приложение локально.
Требования

Операционная система: Windows 10/11
.NET Framework: Версия 6.0 или выше
PostgreSQL: Версия 15 или выше
Visual Studio: 2022 (или другая IDE с поддержкой C# и WPF)
Git: Для клонирования репозитория

Шаги установки

Клонируйте репозиторий:
git clone https://github.com/your-username/DatabaseManager.git
cd DatabaseManager


Установите зависимости:

Откройте проект в Visual Studio и выполните восстановление NuGet-пакетов:dotnet restore


Или выберите Tools → NuGet Package Manager → Restore NuGet Packages в Visual Studio.


Настройте базу данных:

Установите PostgreSQL и создайте базу данных financebook:CREATE DATABASE financebook;


В файле DatabaseService.cs обновите строку подключения:private readonly string _connectionString = "Host=localhost;Username=your_username;Password=your_password;Database=financebook";

Замените your_username и your_password на ваши учетные данные PostgreSQL.
Выполните SQL-скрипт schema.sql (находится в корне репозитория) для создания таблиц:psql -U your_username -d financebook -f schema.sql




Скомпилируйте и запустите проект:

В Visual Studio выберите Build → Build Solution или выполните:dotnet build


Запустите приложение через Visual Studio (F5) или с помощью:dotnet run





Структура базы данных
База данных financebook состоит из 25 таблиц, обеспечивающих полный учет финансовых данных:

Users — пользователи системы.
Roles — роли пользователей.
UserRoles — связь пользователей и ролей.
Permissions — права доступа.
RolePermissions — связь ролей и прав.
Counterparties — контрагенты.
BankAccounts — банковские счета.
Contracts — контракты.
ChartOfAccounts — план счетов.
Transactions — бухгалтерские проводки.
Documents — документы.
DocumentItems — элементы документов.
FixedAssets — основные средства.
Depreciation — амортизация.
AssetMovements — перемещения основных средств.
Warehouses — склады.
ProductCategories — категории продуктов.
Products — продукты.
Inventory — инвентарь.
InventoryMovements — перемещения инвентаря.
Departments — отделы.
Employees — сотрудники.
SalaryPayments — выплаты зарплат.
Taxes — налоги.
FinancialReports — финансовые отчеты.

SQL-скрипт для создания таблиц находится в файле schema.sql.
Использование

Запустите приложение:
Откройте приложение через Visual Studio или скомпилированный .exe в папке bin/Debug.


Выберите таблицу:
В главном окне выберите таблицу из выпадающего списка (например, FixedAssets, Transactions).


Работа с данными:
Просматривайте, добавляйте, редактируйте или удаляйте записи с помощью интерфейса.


Расчеты:
Рассчитайте амортизацию, выбрав метод (линейный или уменьшаемый остаток).
Начислите зарплату сотрудникам с учетом налогов.


Экспорт/импорт:
Экспортируйте данные в JSON через кнопку "Экспорт в JSON".
Импортируйте данные из JSON через кнопку "Импорт из JSON".


Формирование отчетов:
Сформируйте оборотно-сальдовую ведомость, бухгалтерский баланс или рассчитайте НДС через соответствующие кнопки.



Пример использования

Перейдите в таблицу FixedAssets и добавьте новое основное средство (например, оборудование стоимостью 100,000).
Нажмите "Рассчитать амортизацию", выбрав метод "Линейный".
Перейдите в таблицу Depreciation, чтобы просмотреть результаты расчета.
Сформируйте бухгалтерский баланс через кнопку "Бухгалтерский баланс".
Экспортируйте данные таблицы FixedAssets в JSON для резервного копирования.

Ограничения и будущие улучшения
Текущие ограничения

В методе RegisterTransactionCommand используются фиксированные значения для DebitAccountId и CreditAccountId. Планируется добавить пользовательский ввод.
Расчет амортизации методом уменьшаемого остатка не учитывает остаточную стоимость актива.
Экспорт/импорт ограничен JSON; поддержка CSV не реализована.
Отсутствует полноценная система авторизации и проверки прав доступа.

Планируемые улучшения

Добавить поддержку экспорта/импорта в формате CSV.
Реализовать отслеживание остаточной стоимости активов для метода уменьшаемого остатка.
Внедрить авторизацию с проверкой ролей и прав.
Добавить тестирование (юнит-тесты для сервисов и стратегий).
Улучшить пользовательский интерфейс с добавлением фильтров и сортировки в таблицах.

Структура проекта
DatabaseManager/
├── DatabaseManager/
│   ├── Models/                # Классы моделей (FixedAsset, Transaction и т.д.)
│   ├── Services/              # Сервисы (DatabaseService, JsonService)
│   ├── Strategies/            # Реализации паттерна "Стратегия" (IDepreciationStrategy, ITaxStrategy)
│   ├── ViewModel/             # ViewModel (MainViewModel)
│   ├── Views/                 # XAML-файлы (MainWindow.xaml)
│   └── App.xaml
├── schema.sql                 # SQL-скрипт для создания базы данных
├── README.md                  # Документация проекта
├── .gitignore                 # Файл игнорирования для Git
└── DatabaseManager.sln        # Файл решения Visual Studio

Лицензия
Проект распространяется под лицензией MIT License. Вы можете свободно использовать, копировать, модифицировать и распространять код при соблюдении условий лицензии.
Контакты
Для вопросов, предложений или сообщений об ошибках:

Email: your-email@example.com
GitHub: your-username


Разработано с учетом требований задания, с акцентом на качество кода, архитектуру и документацию. Благодарю за использование DatabaseManager!
